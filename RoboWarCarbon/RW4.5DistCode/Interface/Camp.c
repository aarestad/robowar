/* Camp.c *//*	Written 12/23/89 by David Harris	(c) 1989 David Harris 		This file contains routines used only in the camp segment of the arena.*//* #includes */#include <Carbon/Carbon.h>#include "robotypes.h"#include "Tokens.h"/* Globals *//* External Variables */extern	WindowPtr		myWindow;extern	EventRecord		myEvent;extern	MenuHandle		myMenus[5];extern	ControlHandle	goButton;	extern	ControlHandle	pauseButton;	extern	ControlHandle	stepButton;extern  ControlHandle	chrononButton;extern	ControlHandle	battleButton;extern	short			numBots;extern	robot			rob[maxBots];extern	short			botSelected;extern	short			isBattle;extern	short			pausedFlag;extern	short			stepFlag;extern	short			chrononFlag;extern	short			useDebugger;extern	short			displayCode;extern	short			rosterChanged;/* Prototypes */void clickCamp(void);void adjustHilite(char c);void setAlone(void);void setTeam1(void);void setTeam2(void);void setTeam3(void);/* in Util.c */extern void drawRobot(short,short,short,short,short,RgnHandle,short);/* in ArenaControl.c */void drawBits(void);void drawStats(void);/* Functions */void clickCamp(void){	Rect r,limit,slop;	short old,i;	long a,b;	RgnHandle botRgn;	long result;		GlobalToLocal(&myEvent.where);	if (myEvent.where.h > 302 && myEvent.where.h < 499 &&		myEvent.where.v > 0 && myEvent.where.v < 204 && !isBattle) {		old = botSelected;		botSelected = (short)((myEvent.where.v)/34);		if (botSelected >= numBots) botSelected = maxBots;		if (botSelected != maxBots) {			if (old != botSelected) {				r.top = old*34; r.bottom = 34+r.top;				r.left = 302; r.right = 500;				if (old != maxBots)					InvalRect(&r);				r.top = botSelected*34; r.bottom = 34+r.top;				InvalRect(&r);				r.top = 252; r.bottom = 300;				InvalRect (&r);			}		}		else if (old != maxBots) {			r.top = old*34; r.bottom = 34+r.top;			r.left = 302; r.right = 500;			InvalRect(&r);			r.top = 252; r.bottom = 300;			InvalRect (&r);		}	}	else if (myEvent.where.h < 300 && myEvent.where.h > 0 && 			 myEvent.where.v > 0 && myEvent.where.v < 300 && isBattle) {			 	for (i=0; i<numBots; i++) {			 		a = myEvent.where.h-rob[i].letters[x_];			 		b = myEvent.where.v-rob[i].letters[y_];			 		if (a*a+b*b < radiusSquared) {			 			slop.top = limit.top = 0; slop.left = limit.left = 0; 			 			slop.right = limit.right = 300; slop.bottom = limit.bottom = 300;			 			botRgn = NewRgn();			 			OpenRgn();			 			r.top = rob[i].letters[y_]-10; r.left = rob[i].letters[x_]-10;			 			r.bottom = rob[i].letters[y_]+10; r.right = rob[i].letters[x_]+10;			 			FrameOval(&r);			 			CloseRgn(botRgn);			 			result = DragGrayRgn(botRgn,myEvent.where,&limit,&slop,			 								 noConstraint,NULL);			 			DisposeRgn(botRgn);			 			if (HiWord(result) != -32768) {				 			rob[i].letters[x_] += LoWord(result);				 			rob[i].letters[y_] += HiWord(result);				 		}			 			i = numBots;						drawBits();						drawStats();			 		}			 	}	}}void adjustHilite(char c){	short old;	Rect r;		old = botSelected;	if ((c == 0x1F || c == 0x1D) && numBots > 0 && !isBattle) {		if (botSelected == maxBots) botSelected = 0;		else if (botSelected == numBots-1) botSelected = maxBots;		else botSelected++;	}	else if ((c == 0x1E || c == 0x1C) && numBots > 0 && !isBattle) {		if (botSelected == maxBots) botSelected = numBots-1;		else if (botSelected == 0) botSelected = maxBots;		else botSelected--;	}	else if (useDebugger != maxBots && isBattle) {		if ((c == 'g' || c == 'G') && pausedFlag) {			pausedFlag = 0;			HiliteControl(goButton,255);			HiliteControl(pauseButton,0);			HiliteControl(stepButton,255);			HiliteControl(chrononButton,255);		}		else if ((c == 'p' || c == 'P') && !pausedFlag) {			pausedFlag = 1;			HiliteControl(goButton,0);			HiliteControl(pauseButton,255);			HiliteControl(stepButton,0);			HiliteControl(chrononButton,0);		}		else if ((c == 'c' || c == 'C') && pausedFlag) chrononFlag = 1;		else if ((c == 's' || c == 'S') && pausedFlag) stepFlag = 1;	}				if (old != botSelected) {		r.left = 302; r.right = 500;		if (old != maxBots) {			r.top = old*34; r.bottom = r.top+34;			InvalRect(&r);		}		if (botSelected != maxBots) {			r.top = botSelected*34; r.bottom = r.top+34;			InvalRect (&r);		}		r.top = 252; r.bottom = 300;		InvalRect (&r);	}}		void setAlone(void){	Rect r;		if (botSelected != maxBots) {		rob[botSelected].team = 0;		r.top = 0; r.left = 302; r.right = 500; r.bottom = 205;		InvalRect(&r);		r.top = 0; r.left = 300; r.right = 300; r.bottom = 300;		InvalRect(&r);	}	rosterChanged = 1;}void setTeam1(void){	Rect r;		if (botSelected != maxBots) {		rob[botSelected].team = 1;			r.top = 0; r.left = 302; r.right = 500; r.bottom = 205;		InvalRect(&r);		r.top = 0; r.left = 300; r.right = 300; r.bottom = 300;		InvalRect(&r);	}	rosterChanged = 1;}void setTeam2(void){	Rect r;		if (botSelected != maxBots) {		rob[botSelected].team = 2;			r.top = 0; r.left = 302; r.right = 500; r.bottom = 205;		InvalRect(&r);		r.top = 0; r.left = 300; r.right = 300; r.bottom = 300;		InvalRect(&r);	}	rosterChanged = 1;}void setTeam3(void){	Rect r;		if (botSelected != maxBots) {		rob[botSelected].team = 3;			r.top = 0; r.left = 302; r.right = 500; r.bottom = 205;		InvalRect(&r);		r.top = 0; r.left = 300; r.right = 300; r.bottom = 300;		InvalRect(&r);	}	rosterChanged = 1;}