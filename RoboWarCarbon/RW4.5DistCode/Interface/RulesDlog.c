//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ FileName: PrefsDialog.c //-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// Written: 16/4/98 by Lucas Dixon//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=////	This file contains routines for handling the prefs dialog////-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ includes #include <Carbon/Carbon.h>#include "robotypes.h"//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ Local Global Data// ---const	cRulesDialogID	=	2002;Handle		rulesControls[5];//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ Extern Vars// --- Main.cextern prefStruct			gPrefs;	extern WindowPtr 			myWindow;extern macFeatures			features;extern MenuHandle			myMenus[9];//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ Function Defs// ---void 			DoRulesDialog(void);Boolean 		RulesEventFilter(DialogPtr theDialog, short* itemHit);//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥ extern Function Defs// --- util.cextern void reportMessage(char *message1,char *message2);extern void installButtonOutline(DialogPtr theDialog,short itemNo);// --- main.c extern void updateEvent(void);extern void doSetMaxPoints(void);extern void activateRoboWar(void);// --- defines for dialogItem ID's#define kDItem_OKBtn			1#define kDItem_CancelBtn		2#define kDItem_NoMoveShootChkBx	7#define kDItem_NoDronesChkBx	8#define kDItem_NoLazersChkBx	9// --- define control items in array#define kCItem_OKBtn			0#define kCItem_CancelBtn		1#define kCItem_NoMoveShootQ		2#define kCItem_NoDronesQ		3#define kCItem_NoLazersQ		4//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥// ---void DoRulesDialog(void){	DialogPtr		theDialog;	Boolean			allDone=false;	short			ItemHit;	//long			tmpLong;	Rect			controlRect;	short			theItemType;		theDialog = GetNewDialog(cRulesDialogID, 0L, (WindowPtr)-1L);		GetDialogItem(	theDialog, 						kDItem_OKBtn, 									&theItemType, 	&(rulesControls[kCItem_OKBtn]), 		&controlRect);	// ok btn	GetDialogItem(	theDialog, 						kDItem_CancelBtn, 								&theItemType, 	&(rulesControls[kCItem_CancelBtn]), 	&controlRect);	// cancel btn	GetDialogItem(	theDialog, 						kDItem_NoMoveShootChkBx, 						&theItemType, 	&(rulesControls[kCItem_NoMoveShootQ]),	&controlRect);	// tourney log	GetDialogItem(	theDialog, 						kDItem_NoDronesChkBx, 							&theItemType, 	&(rulesControls[kCItem_NoDronesQ]),		&controlRect);	// max HW points Btn	GetDialogItem(	theDialog, 						kDItem_NoLazersChkBx,							&theItemType, 	&(rulesControls[kCItem_NoLazersQ]), 	&controlRect);	// max HW points Txt		SetControlValue( (ControlHandle)rulesControls[kCItem_NoMoveShootQ], gPrefs.rules_noMoveShoot);	SetControlValue( (ControlHandle)rulesControls[kCItem_NoDronesQ],	gPrefs.rules_noDrones);	SetControlValue( (ControlHandle)rulesControls[kCItem_NoLazersQ], 	gPrefs.rules_noLazers);		DrawControls( theDialog );	DrawDialog(theDialog);	//AllMenusOff();	while(!allDone)	{		if( RulesEventFilter(theDialog,  &ItemHit) )		{			switch(ItemHit)			{				case kDItem_OKBtn: // OK btn						allDone = true;												gPrefs.rules_noMoveShoot = GetControlValue((ControlHandle)rulesControls[kCItem_NoMoveShootQ]);						gPrefs.rules_noDrones 	 = GetControlValue((ControlHandle)rulesControls[kCItem_NoDronesQ]);						gPrefs.rules_noLazers 	 = GetControlValue((ControlHandle)rulesControls[kCItem_NoLazersQ]);						break;									case kDItem_CancelBtn:					allDone = true;					break;								case kDItem_NoMoveShootChkBx: // - Disalow Move shoot dlog					SetControlValue((ControlHandle)rulesControls[kCItem_NoMoveShootQ], 							1 - GetControlValue((ControlHandle)rulesControls[kCItem_NoMoveShootQ]) );					break;								case kDItem_NoDronesChkBx: // - Disalow Drones					SetControlValue((ControlHandle)rulesControls[kCItem_NoDronesQ], 							1 - GetControlValue((ControlHandle)rulesControls[kCItem_NoDronesQ]) );					break;				case kDItem_NoLazersChkBx: // - Disalow Lazers					SetControlValue((ControlHandle)rulesControls[kCItem_NoLazersQ], 							1 - GetControlValue((ControlHandle)rulesControls[kCItem_NoLazersQ]) );					break;			}		}	}		DisposeDialog(theDialog);	//DoOnMenuBar();	//AllMenusOn();	//activateRoboWar();}//-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=// ¥// ---Boolean RulesEventFilter(DialogPtr theDialog, short* itemHit){	//short eventHappened;	short part;	unsigned long finalTicks;	EventRecord theEvent;	WindowPtr	theWindow;	//short		tmpShort;	if( WaitNextEvent(everyEvent,&theEvent,5,NULL) )	{		switch( theEvent.what )		{			case updateEvt:				if( ((WindowPtr)theEvent.message) == (WindowPtr)theDialog )				{					BeginUpdate(theDialog);						UpdateDialog(theDialog, theDialog->visRgn );					EndUpdate(theDialog);					return false;				}				else if( ((WindowPtr)theEvent.message) == myWindow )				{					updateEvent();					return false;				}				break;							case mouseDown:				part = FindWindow( theEvent.where, &theWindow );				if( theWindow != theDialog )					SysBeep(0);				else 				{					switch( part )					{						case inDrag:							DragWindow( theWindow, theEvent.where, &(**(GetGrayRgn())).rgnBBox);						case inContent:							return DialogSelect( &theEvent, &theDialog, itemHit );							break;												default:							return DialogSelect( &theEvent, &theDialog, itemHit );							break;					}				}				break;							case keyDown:			case autoKey:				if( (theEvent.message & charCodeMask) == '\n' )				{	// ok btn hit					HiliteControl((ControlHandle)rulesControls[kCItem_OKBtn], true);					Delay(8,&finalTicks);					HiliteControl((ControlHandle)rulesControls[kCItem_OKBtn], false);					*itemHit = 1; // BAD BAD BAD! Should link it to the control, but it's too late!					return true;				}				else if( (theEvent.message & charCodeMask) == '.' && theEvent.modifiers & cmdKey )				{	// cancel btn hit					HiliteControl((ControlHandle)rulesControls[kCItem_CancelBtn], true);					Delay(8,&finalTicks);					HiliteControl((ControlHandle)rulesControls[kCItem_CancelBtn], false);					*itemHit = 2; // BAD BAD BAD! Should link it to the control, but it's too late!					return true;				}				else					return DialogSelect( &theEvent, &theDialog, itemHit );				break;						default:				return false;					}	}		return false;}